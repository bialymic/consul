---
layout: docs
page_title: Encryption Systems
description: >-
  Consul supports encrypting all of its network traffic. Remote Procedure Calls (RPCs) between client and server agents can be encrypted with TLS and authenticated with certificates. Gossip communication between all agents can also be encrypted.
---

# Encryption

This topic describes the two different encryption systems available in Consul to secure network traffic, Gossip encryption and mTLS.

## Gossip Encryption

Consul uses a [gossip protocol](https://en.wikipedia.org/wiki/Gossip_protocol) to manage membership and broadcast messages to the cluster.

Consul uses the gossip protocol to:
- Identify datacenter members.
- Quickly detect failed members and notify the rest of the cluster.
- Broadcast custom events and queries. These can be used to trigger custom workflows.

The protocol, membership management, and message broadcasting is provided through the [Serf library](https://www.serf.io/). 

Gossip protocol uses, in a default Consul configuration, ports [`8301`](/consul/docs/install/ports#lan-serf) for LAN based communications and [`8302`](/consul/docs/install/ports#lan-serf) for WAN based comminications in federated datacenters. Enabling Gossip encryption on a Consul datacenter will secure traffic on these two ports.

Gossip encryption is symmetric and based on a single key that is shared across all members of the datacenter.



Learn more on how to enable gossip encryption on your Consul datacenter in [Gossip Encryption](/consul/docs/security/encryption/gossip) documentation.

## mTLS Encryption

Consul uses other communication protocols over different ports:

- A [consensus protocol](/consul/docs/architecture/consensus), used to provide consistency over the cluster data stored by Consul servers. It tipically uses port [`8300`](/consul/docs/install/ports#server-rpc).
- Remote Procedure Calls (RPC), to forward requests from client agents to server agents. They use the same port used by the consensus protocol.
- An HTTP[S] interface, tipically exposed on ports [`8500`](/consul/docs/install/ports#http) and [`8501`](/consul/docs/install/ports#https). This interface is used to permit client communication using Consul API interface, CLI, and UI.




The Consul agent supports encrypting all of its network traffic. The exact
method of encryption is described on the [encryption internals page](/consul/docs/security).
There are two separate encryption systems, one for gossip traffic and one for RPC.

To configure the encryption systems on a new cluster, review this following tutorials to
[enable gossip encryption](/consul/tutorials/security/gossip-encryption-secure?utm_source=consul.io&utm_medium=docs) and
[TLS encryption for agent communication](/consul/tutorials/security/tls-encryption-secure?utm_source=docs).



## RPC Encryption with TLS

Consul supports using TLS to verify the authenticity of servers and clients. To enable this,
Consul requires that all clients and servers have key pairs that are generated by a single
Certificate Authority. This can be a private CA, used only internally. The
CA then signs keys for each of the agents, as in
[this tutorial on generating both a CA and signing keys](/consul/tutorials/security/tls-encryption-secure?utm_source=docs).

~> Certificates need to be created with x509v3 extendedKeyUsage attributes for both clientAuth and serverAuth since Consul uses a single cert/key pair for both server and client communications.

TLS can be used to verify the authenticity of the servers or verify the authenticity of clients.
These modes are controlled by the [`verify_outgoing`](/consul/docs/agent/config/config-files#tls_internal_rpc_verify_outgoing),
[`verify_server_hostname`](/consul/docs/agent/config/config-files#tls_internal_rpc_verify_server_hostname),
and [`verify_incoming`](/consul/docs/agent/config/config-files#tls_internal_rpc_verify_incoming) options, respectively.

If [`verify_outgoing`](/consul/docs/agent/config/config-files#tls_internal_rpc_verify_outgoing) is set, agents verify the
authenticity of Consul for outgoing connections. Server nodes must present a certificate signed
by a common certificate authority present on all agents, set via the agent's
[`ca_file`](/consul/docs/agent/config/config-files#tls_internal_rpc_ca_file) and [`ca_path`](/consul/docs/agent/config/config-files#tls_internal_rpc_ca_path)
options. All server nodes must have an appropriate key pair set using [`cert_file`](/consul/docs/agent/config/config-files#tls_internal_rpc_cert_file) and [`key_file`](/consul/docs/agent/config/config-files#tls_internal_rpc_key_file).

If [`verify_server_hostname`](/consul/docs/agent/config/config-files#tls_internal_rpc_verify_server_hostname) is set, then
outgoing connections perform hostname verification. All servers must have a certificate
valid for `server.<datacenter>.<domain>` or the client will reject the handshake. This is
a new configuration as of 0.5.1, and it is used to prevent a compromised client from being
able to restart in server mode and perform a MITM (Man-In-The-Middle) attack. New deployments should set this
to true, and generate the proper certificates, but this is defaulted to false to avoid breaking
existing deployments.

If [`verify_incoming`](/consul/docs/agent/config/config-files#tls_internal_rpc_verify_incoming) is set, the servers verify the
authenticity of all incoming connections. All clients must have a valid key pair set using
[`cert_file`](/consul/docs/agent/config/config-files#tls_internal_rpc_cert_file) and
[`key_file`](/consul/docs/agent/config/config-files#tls_internal_rpc_key_file). Servers will
also disallow any non-TLS connections. To force clients to use TLS,
[`verify_outgoing`](/consul/docs/agent/config/config-files#tls_internal_rpc_verify_outgoing) must also be set.

TLS is used to secure the RPC calls between agents, but gossip between nodes is done over UDP
and is secured using a symmetric key. See above for enabling gossip encryption.

## Configuring TLS on an existing cluster

As of version 0.8.4, Consul supports migrating to TLS-encrypted traffic on a running cluster
without downtime. This process assumes a starting point with no TLS settings configured and involves
an intermediate step in order to get to full TLS encryption. Review the
[Securing RPC Communication with TLS Encryption tutorial](/consul/tutorials/security/tls-encryption-secure?utm_source=docs)
for the step-by-step process to configure TLS on a new or existing cluster. Note the call outs there
for existing cluster configuration.
